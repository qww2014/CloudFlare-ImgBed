"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[151],{448:function(e,t,a){a(3360)},5151:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var i=a(706),n=(a(3360),a(4898),a(9738)),o=(a(5700),a(767)),s=(a(9201),a(3341)),l=(a(448),a(579)),d=(a(8968),a(4057),a(3443),a(1812)),r=(a(3492),a(59),a(2733)),h=(a(672),a(1094)),c=a(7174),u=a(5967),p=a(114);const m=e=>((0,u.Qi)("data-v-61d3f65c"),e=e(),(0,u.jt)(),e),g={class:"container"},b={class:"header-content"},f={class:"header-action"},k={class:"main-container"},y={style:{margin:"8px"}},w=m((()=>(0,u.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1))),C=["src"],v={key:2,style:{width:"100px",height:"100px",display:"flex","justify-content":"center","align-items":"center"}},T={class:"pagination-container"},L=(0,u.eW)("加载更多");function S(e,t,a,m,S,F){const D=c.A,x=(0,u.g2)("font-awesome-icon"),z=h.R7,_=r.bZ,W=l.o8,A=d.Zq,E=l.Up,P=s.qi,$=o.aQ,U=n.S2,G=i.L;return(0,u.uX)(),(0,u.CE)("div",g,[(0,u.bF)(_,null,{default:(0,u.k6)((()=>[(0,u.Lk)("div",b,[(0,u.bF)(D,{activeTab:"customerConfig"}),(0,u.Lk)("div",f,[(0,u.bF)(z,{disabled:F.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(x,{icon:"sign-out-alt",class:"header-icon",onClick:F.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,u.Lk)("div",k,[(0,u.bo)((0,u.bF)(E,{data:F.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,u.k6)((()=>[(0,u.bF)(W,{type:"expand"},{default:(0,u.k6)((e=>[(0,u.Lk)("div",y,[w,(0,u.bF)(E,{data:e.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,u.k6)((()=>[(0,u.bF)(W,{prop:"metadata.FileName",label:"文件名"}),(0,u.bF)(W,{prop:"name",label:"文件预览"},{default:(0,u.k6)((({row:e})=>[e.metadata?.FileType?.includes("image")?((0,u.uX)(),(0,u.Wv)(A,{key:0,src:"/file/"+e.name+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,u.uX)(),(0,u.CE)("video",{key:1,src:"/file/"+e.name+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,C)):((0,u.uX)(),(0,u.CE)("div",v,[(0,u.bF)(x,{icon:"file",style:{"font-size":"2em"}})]))])),_:1}),(0,u.bF)(W,{formatter:F.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":F.sortByTimestamp},{default:(0,u.k6)((({row:e})=>[(0,u.eW)((0,p.v_)(F.formatTimeStamp(e.metadata.TimeStamp)),1)])),_:1},8,["formatter","sort-method"])])),_:2},1032,["data","default-sort"])])])),_:1}),(0,u.bF)(W,{prop:"ip",label:"IP地址"}),(0,u.bF)(W,{prop:"address",label:"地址"}),(0,u.bF)(W,{prop:"count",label:"上传次数",sortable:""}),(0,u.bF)(W,{label:"允许上传"},{default:(0,u.k6)((({row:e})=>[(0,u.bF)(P,{modelValue:e.enable,"onUpdate:modelValue":t=>e.enable=t,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:t=>F.handleSwitchEnable(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"]),[[G,S.loading]]),(0,u.Lk)("div",T,[(0,u.bF)($,{background:"",layout:"prev, pager, next",total:S.dealedData.length,"current-page":S.currentPage,"page-size":S.pageSize,onCurrentChange:F.handlePageChange},null,8,["total","current-page","page-size","onCurrentChange"]),S.currentPage===Math.ceil(S.dealedData.length/S.pageSize)?((0,u.uX)(),(0,u.Wv)(U,{key:0,type:"primary",onClick:F.loadMoreData,loading:S.loading,class:"load-more"},{default:(0,u.k6)((()=>[L])),_:1},8,["onClick","loading"])):(0,u.Q3)("",!0)])])])}a(9138),a(4192),a(8856),a(5342);var F=a(9297),D={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:c.A},computed:{...(0,F.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768},paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.dealedData.slice(e,t)}},methods:{async fetchWithAuth(e,t={}){this.credentials&&(t.headers={...t.headers,Authorization:`Basic ${this.credentials}`},t.credentials="include");const a=await fetch(e,t);if(401===a.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return a},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)},async handleSwitchEnable(e){const t=e.ip,a=e.enable;a?(this.blockipList=this.blockipList.filter((e=>e!==t)),await this.fetchWithAuth("/api/manage/cusConfig/whiteip",{method:"POST",body:t})):(this.blockipList.push(t),await this.fetchWithAuth("/api/manage/cusConfig/blockip",{method:"POST",body:t}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,t=20;this.fetchWithAuth(`/api/manage/cusConfig/list?start=${e}&count=${t}`,{method:"GET"}).then((e=>e.json())).then((e=>{this.dealedData=this.dealedData.concat(e.map((e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}})))})).catch((()=>{this.$message.error("加载更多数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1}))},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((e=>e.text())).then((e=>{if("true"==e)return this.showLogoutButton=!0,this.fetchWithAuth("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return this.fetchWithAuth("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")})).then((e=>e.json())).then((async e=>{const t=await this.fetchWithAuth("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.dealedData=e.map((e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}}))})).catch((e=>{"Unauthorized"!==e.message&&this.$message.error("同步数据时出错，请检查网络连接")})).finally((()=>{this.loading=!1}))}},x=a(1858);const z=(0,x.A)(D,[["render",S],["__scopeId","data-v-61d3f65c"]]);var _=z}}]);
//# sourceMappingURL=151.30020aa3.js.map